<html>
<head>
	
	<script type="text/javascript" src="node_modules/phaser/build/phaser.js"></script>
	<!-- <script type="text/javascript" src="node_modules/pixi.js/bin/pixi.dev.js"></script> -->
	<script type="text/javascript" src="bin/voronoi-map.js"></script>
	<script type="text/javascript" src="src/rotating-calipers.js"></script>
</head>
<body>
	<script type="text/javascript">

    var map = voronoiMap.map({width: 1000.0, height: 1000.0});
    map.newIsland(voronoiMap.islandShape.makeRadial(1), 1);
    map.go0PlacePoints(100, voronoiMap.pointSelector.generateRandom(map.SIZE.width, map.SIZE.height, map.mapRandom.seed));
    map.go1BuildGraph();
    map.assignBiomes();
    map.go2AssignElevations();
    map.go3AssignMoisture();
    map.go4DecorateMap();	

	window.onload = function() {
		//renderPixi();
		renderPhaser();
		//renderCanvas();

	};	

	function renderCanvas() {
		var canvas = document.createElement('canvas');
		canvas.width = map.SIZE.width;
		canvas.height = map.SIZE.height;
		var context = canvas.getContext('2d');
		voronoiMap.renderCanvas.graphicsReset(context, map.SIZE.width, map.SIZE.height, voronoiMap.style.displayColors);
		voronoiMap.renderCanvas.renderDebugPolygons(context, map, voronoiMap.style.displayColors);
		document.body.appendChild(canvas);

	}

	function renderPixi() {
		var context = voronoiMap.renderPixi.createNewCanvasContext(map.SIZE.width, map.SIZE.height)
		document.body.appendChild(context.renderer.view);
		voronoiMap.renderPixi.graphicsReset(context, voronoiMap.style.displayColors);
		voronoiMap.renderPixi.renderDebugPolygons(context, map, voronoiMap.style.displayColors);
		context.renderer.render(context.stage);
	}

	function renderPhaser() {

		var game = new Phaser.Game(1000, 1000, Phaser.CANVAS, '', { preload: preload, create: create, update: update});


	    function preload () {
			game.time.advancedTiming = true;
	    }
	    
	    function initDebugging()
	    {


	    }

	    function create () {



		    var context = game;	    
		    
		    voronoiMap.renderPhaser.graphicsReset(context, map.SIZE.width, map.SIZE.height, voronoiMap.style.displayColors);
		    voronoiMap.renderPhaser.renderDebugPolygons(context, map, voronoiMap.style.displayColors);


			// var graphics = game.add.graphics(0, 0);

	  //       var colors = voronoiMap.style.displayColors;

	  //       for (var centerIndex = 0; centerIndex < map.centers.length; centerIndex++) {
	  //           var p = map.centers[centerIndex];
	  //           var x,y,right,bottom;
	  //           for (var neighborIndex = 0; neighborIndex < p.neighbors.length; neighborIndex++) {
	  //               let r = p.neighbors[neighborIndex];
	  //               let edge = map.lookupEdgeFromCenter(p, r);
	  //               let color = colors[p.biome];
	  //               let corner0 = edge.v0;
	  //               let corner1 = edge.v1;
	  //           }

   //              graphics.lineStyle(2, 0xFF6600);
   //              graphics.moveTo(edge.v0.point.x, edge.v0.point.y);
   //              graphics.lineTo(edge.v1.point.x, edge.v1.point.y);	


			// 	//points = [[283, 252], [421, 182], [399, 328]]
			// 	if (points.length > 2) {
			// 		var solver = new RotatingCalipers( points )
			// 		var hull = solver.convexHull();
			// 		var maer = solver.minAreaEnclosingRectangle().vertices;
			// 		ctx.clearRect(0,0, canvas.width, canvas.height);
			// 		ctx.strokeStyle = "black";
			// 		ctx.beginPath();
			//     	ctx.moveTo(hull[0][0], hull[0][1]);
			// 	    for (var i = 1; i < hull.length; i++) {
			// 	    	ctx.lineTo(hull[i][0], hull[i][1])
			// 	    };
			// 	    ctx.closePath();
			// 	    ctx.stroke();
			// 	    ctx.strokeStyle = "blue";
			// 			ctx.beginPath();
			// 	    ctx.moveTo(maer[0][0], maer[0][1]);
			// 	    for (var i = 1; i < maer.length; i++) {
			// 	    	ctx.lineTo(maer[i][0], maer[i][1])
			// 	    };
			// 	    ctx.closePath();
			// 	    ctx.stroke();
			// 		for (var i = 0; i < points.length; i++) {
			// 			ctx.arc(points[i][0], points[i][1], 5, 0, 2 * Math.PI, false);
			// 		};
			// 	}
        	//}			    		   	
	    }
	    
	    function update() {
			game.debug.text(this.time.fps || '--', 2, 14, "#00ff00");	    		

	    }	

	}
	   	  
	</script>
</body>
</html>